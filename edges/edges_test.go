package edges_test

import (
	"testing"

	"github.com/dharnitski/cc-hosts/access/file"
	"github.com/dharnitski/cc-hosts/edges"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
)

func getEdges(t *testing.T) *edges.Edges {
	offsets, err := edges.NewOffsets()
	require.NoError(t, err)
	return edges.NewEdges(file.NewGetter("../data/edges"), *offsets)
}

func TestEdgesGet(t *testing.T) {
	t.Parallel()

	v := getEdges(t)

	tests := []struct {
		id       string
		expected []string
	}{
		{
			id: "119",
			expected: []string{
				"103915891", "104753843", "105051572", "105145007", "105601796", "106441762", "106537403", "106632256", "106708450", "107368075", "10951429", "109776461",
				"114", "114054162", "117542638", "118852860", "119019024", "120", "122329998", "122660165", "123575261", "125273681", "125495967", "125507163", "127351893", "129996656",
				"131172095", "136450361", "137502946", "138", "139472015", "140263070", "140528180", "141659302", "145929928", "147978021", "148679400", "149", "150", "151126197",
				"152234684", "156687075", "156968044", "157313404", "159487510", "159511799", "160276317", "160923986", "161541663", "166", "166182441", "170681355", "170681369",
				"172051766", "172957705", "174816527", "175022098", "175135482", "175896515", "1789764", "180515436", "189964921", "189965114", "196223847", "196223855", "197186394",
				"198160903", "1985431", "200", "206112811", "207839804", "207968093", "210340923", "210343909", "210346285", "210346456", "210372299", "210394831", "210395766", "210395850",
				"210437356", "219574620", "220722718", "220919256", "220959634", "220973297", "220973692", "220973693", "221", "221172791", "221318811", "221322581", "221593650", "221633095",
				"221656255", "221658494", "221658790", "221662307", "221728347", "221800375", "221821291", "221825636", "221914920", "222293772", "222340160", "222344044", "222354211",
				"222355218", "222357177", "222359466", "222370172", "222451771", "222742249", "222882086", "222883581", "224877535", "224968753", "225545437", "225781605", "228371144",
				"229179956", "233713041", "234", "234278715", "234666833", "234666834", "234666835", "239163854", "243331109", "244851564", "244851647", "244887603", "244923247",
				"244988953", "244988960", "244988963", "244988989", "245169114", "245273158", "245847554", "246276088", "246314652", "246398994", "246533909", "246551434", "246559256",
				"246879974", "246880025", "247116160", "247172369", "247378029", "247438328", "247438355", "247512670", "248407015", "248778327", "248810748", "248810779", "248813124",
				"248837090", "248870934", "248909986", "248921257", "249116676", "249479550", "249503740", "249826151", "250368383", "251444251", "251617291", "251905898", "252165959",
				"252189270", "252469328", "252550814", "254001669", "254001745", "254009472", "254009715", "254012484", "255232124", "266176072", "271", "274322312", "278121015",
				"278168263", "278323048", "278985498", "283", "297", "2990483", "3178597", "32564123", "32797309", "32801677", "32801765", "32804262", "32805863", "32806914", "32998083",
				"32998091", "33000037", "3313692", "40234983", "40235263", "40235274", "40235279", "40235294", "40235315", "40236185", "40466237", "40686214", "41073672", "41198668",
				"41199315", "41199316", "41489538", "46218093", "46218289", "46386328", "4766427", "53006013", "61515288", "64329371", "67375675", "67516926", "68596572", "69479016",
				"70997323", "71301306", "71938388", "81246294", "81966565", "83977201", "87341598", "88781516", "8981062", "91348036", "92657507", "92671027", "92739497", "93133780",
				"93157745", "93994569", "96865222", "96884963", "96944020", "96948997", "96949002", "96949016", "96953138",
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.id, func(t *testing.T) {
			t.Parallel()
			ids, err := v.Get(t.Context(), tt.id)
			require.NoError(t, err)
			require.NotEmpty(t, ids)
			assert.Equal(t, tt.expected, ids)
		})
	}
}
